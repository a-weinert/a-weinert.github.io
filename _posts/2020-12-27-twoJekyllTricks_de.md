---
layout: weAutPost
title: Jekyll-Tricks
bigTitle: Zwei Jekyll-Tricks
permalink: /:title.html
categories: Typo3 Markdown Jekyll php Apache
lang: de
enPage: twoJekyllTricks.html
copyrightYear: 2020
revision: 1
reviDate: 2020-12-27
date:   2020-12-27
itemtype: "http://schema.org/BlogPosting"
isPost: true
commentIssueId: 4
commentShare:
---

Wer meine 
[Schlussbemerkungen](/leaveTypo3_de.html#dr-jekylls-site-generator "Dr. Jekyll's site generator")
in [Weg von Typo3](/leaveTypo3_de.html "Aus für Typo3") las, weiß, dass ich
ein engagierter Befürworter der statischen Generierung von Web-Bereichen bin.
Diese sind schneller als jedes 
<abbr title="content management systems">CMS</abbr> und fühlen sich auch auf 
preiswerten Servern wohl, die kaum mehr als Apache<!--more--> 2.4 zu
bieten haben.

Mit dem direkten Bearbeiten der .html-Dateien kommt man natürlich nicht weit. 
Vielmehr wird man den Bereich aus übersichtlichen Textblöcken -- den
Quelldateien sozusagen -- zusammensetzen bzw. bereits mit Tools auf
dem Entwicklungsrechner generieren lassen.
    
Idealerweise läuft der selbe Generator auch auf dem Server des
Versions&shy;verwaltungs&shy;systems für besagte Quell&shy;dateien. Im Fall von 
<abbr title="Subversion">SVN</abbr> würde ein post commit*) hook den 
Bereich neu generieren und geänderte Inhalte zum Web-Server**)
transferieren.    
<small>Anm. *):&nbsp; Bei GIT wäre das ein "post push hook".
<br />Anm. **): Der SVN server und der (Apache) Web-Server müssen nicht 
auf derselben Maschine sein, um diesen Komfort für Web-Autoren zu
ermöglichen.</small>

Über zwölf Jahre habe ich statische Generierung von Web-Bereichen mit
[Frame4](https://frame4j.de/index.html "ein Java (8) framework") Tools
betrieben. Von 2019 bis heute habe ich alle meine und mir anvertraute
Web-Bereiche auf Jekyll/Liquid umgestellt.


## Eine kleine Dosis PHP -- Trick Nr. 1

Despite (Entschuldigung, noch zu übersetzen) 
all advantages of static sites compared to those generated at 
request with PHP (Mostly, seldom Java) and
<abbr title="Data base systems">DBS</abbr> by the web server one might need
a server information, some times. One example is displaying the account name
of a user currently logged in. Thats trivially easy on the server with PHP,
e.g., and virtually impossible for programs (probably JavaSript) on the
client.

Though Jekyll is totally unaware of PHP we can put a bit PHP in a page
by its markdown and make Jekyll generate .php instead of .html. 
[Excerpt](https://weinert-automation.de/software/jekyll/index_en.md "See complete file index_en.md"):

```markdown
---
layout: weAutSimple
.....
headline: Users and Accounts
permalink: userInfo/index_en.php
copyrightYear: 2020
---
-(%- include referenceLinks.txt %}-(%- raw %}
<?php $user_account = $_SERVER['REMOTE_USER']; ?>-(% endraw %}
Some of our informations and [services][enServer] require 
authentication. If you read this, you've successfully logged
in with the [weinert-automation.de][enWeAut]> account
<b>-(% raw %)<?php  echo($user_account);?>-(% endraw %)}</b>.
...
```

<small>Note: Replace -( with {. Due to a bug Jekyll would
execute code in an markdown code example instead of just
displaying it.</small>  

As the 
[excerpt](https://weinert-automation.de/software/jekyll/index_en.md "See complete file index_en.md")
shows
 - injecting a bit PHP is done by the raw/endraw tag pairs and
 - generating .php instead if .html is ordered by permalink in the front 
   matter.    
   permalink also works for "normal" pages not just for posts.
   
You may see the result on 
[weinert-automation.de/userInfo/index_en.php](https://weinert-automation.de/userInfo/index_en.php "Users and Accounts")
when logging in as guest:guest. The Jekyll development server won't display
a .php page. Hence, the testing has to be done on the real server.

This trick #1 wasn't invented by me but found in many places. What I missed 
(and tried to put here) was a complete presentation of all vital points.

Trick #2 on the other hand, I did "invent" and develop to working state. 
Most probably, I would not be the first one, but I was unable to find
anything about it.

## Apaches "fancy indexing" mit Kopf und Fuß -- Trick Nr. 2

The Apache web server will generate very nice -- or even "fancy" --
directory listings 
 - for those directories you explicitly allow that by  
   Options +Indexes or Options +FancyIndexing, e.g., and
 - when the directory in question does not contain a file listed by
   DirectoryIndex, usually index.html, index.htm and index.php.
   
For nice indexing one may provide two html page fragments to be put before
and after the directory table generated by Apache. They are
 - configured by options HeaderName and ReadmeName and are
 - called consequently pub-header.htm and pub-footer.htm in my case.
 
Those fragments pub-header.htm and pub-footer.htm can be held and maintained
in the respective directories. Kindly, Jekyll will copy them to _site 
from whence the deployment process will transfer them to the (real) web
server.  
So far no problem. But besides that having pub-header.htm and
pub-footer.htm is a nuisance:

 1. HTML aware Eclipse will mark both with a lot of errors as they (must)
    have a lot of unclosed respectively unopened tags. This renders
    Eclipse's HTML syntax checks virtually useless for those files.
 2. You can't see / check them while developing as, alas, Jekylls test 
    server cannot index -- be it fancy or not.
 3. Partners and customers well acquainted to Jekyll and Markdown may get
    confused by HTML fragment files -- not visible as said.
 4. Those pub-header.htm and pub-footer.htm contain a lot of repeated code
    contradicting the static site generating philosophy.
    
The idea respectively trick to remedy this situation is simple by itself --
but partly a bit tricky in realisation:

 1. From each distinct pair of pub-header.htm and pub-footer.htm make one
    index.htm -- not .html as all others.    
    Advantage: Eclipse is happy and the jekylls test server shows them 
    (with no index table).
 2. Find the commons and little differences easy to handle and make an
    according layout file. As all your directory listings should look alike
    one layout file should suffice, _layouts/weAutDirHF.htm in my case.
 3. At the union point of the former pub-header.htm and pub-footer.htm 
    insert a line with only a distinct html comment:   
    ```<!-- Apache 2 fancy directory index -->``` 
 4. Now turn all remaining pub-header.htm and pub-footer.htm or index.htm 
    to index.md referring to the layout just made (weAutDirHF.htm).
 5. Let those index.md be generated to index.htm -- not .html as all the
    rest.
 6. In the deployment process, only, split all files index.htm at said
    HTML comment line to pub-header.htm and pub-footer.htm.
    
This split will be made by 
```
  csplit index.htm "/^<small>listing generated by/"
  mv xx00 pub-header.htm
  mv xx01 pub-footer.htm
 ```
on the Linux (web server) machine and the Windows (development) workstation.
csplit is a Linux tools, but will be available on Windows, too, when you
have WinRaspi, WinAVR or the like installed and their tools on the PATH.  
All other details may get clear by reading the (real) 
[example files](https://weinert-automation.de/software/jekyll/). 
